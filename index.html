<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>:baopham</title>
  <meta name="author" content="Bao Pham">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://baopham.github.io">
  <link href="/favicon.png" type="image/png" rel="icon">
  <link href="/atom.xml" rel="alternate" title=":baopham" type="application/atom+xml">

  <link href="/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,300,400italic,400,600italic,600,700italic,700,800italic,800" rel="stylesheet" type="text/css">


  <script src="/javascripts/libs/jquery/jquery-2.0.3.min.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-27192907-6']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

  <body   >
    <div id="wrap">
      <header role="banner">
        <nav class="navbar navbar-default navbar-fixed-top" role="navigation">

  <div class="nav-vim vim-normal hidden-xs hidden-sm">
  <div class="text-center nav-vim vim-cmd">NORMAL</div>

  <div class="text-center nav-vim vim-vcs">
    <i class="fa fa-code-fork"></i>
    source <span class="pull-right">|</span>
  </div>

  <div class="text-center nav-vim vim-name">blog.html</div>

  <div class="text-center nav-vim vim-middle">&nbsp;</div>

  <div class="text-center nav-vim vim-ff">unix <span class="pull-right">|</span></div>

  <div class="text-center nav-vim vim-ft">html</div>

  <div class="text-center nav-vim vim-line-percent">0%</div>

  <div class="text-center nav-vim vim-line-current">
    <i class="fa fa-bars"></i>
    <span class="vim-line-row">0</span>:1
  </div>
</div>


  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">:baopham</a>
    </div>

    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="active">
          <a href="/">Blog</a>
        </li>
        <li >
          <a href="/blog/archives">Archives</a>
        </li>
        <li class="visible-xs">
          <a href="/blog/tags">Tags</a>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
          <a class="subscribe-rss" href="/atom.xml" title="subscribe via RSS">
            <span class="visible-xs">RSS</span>
            <img class="hidden-xs" src="/images/rss.png" alt="RSS">
          </a>
        </li>
        
      </ul>
      
        <form class="search navbar-form navbar-right" action="http://google.com/search" method="GET">
          <input type="hidden" name="q" value="site:baopham.github.io">
          <div class="form-group">
            <input class="form-control" type="text" name="q" placeholder="/search">
          </div>
        </form>
      
    </div>
  </div>
</nav>


      </header>
      <div id="top-header" class="header noise-bg text-center visible-sm visible-xs hidden-print">
  <div class="row">
    
  <section>
    <div>
      <img class="img-circle gravatar-img" src="http://www.gravatar.com/avatar/d1747ec1e8e0325b54071a4f1dab5744?s=400" alt="Gravatar of Bao Pham " title="Gravatar of Bao Pham" />
    </div>
  </section>

    
  <section>
    <ul class="media-list list-inline">
      
        <li class="media">
          <a href="http://github.com/baopham">
            <img class="media-object" src="/images/GitHub-Mark-32px.png" alt="My Github"/>
          </a>
        </li>
      
      
        <li class="media">
          <a href="mailto:gbaopham@gmail.com">
            <img class="media-object" src="/images/email.png" alt="Email me"/>
          </a>
        </li>
      
    </ul>
  </section>


    
  </div>
</div>


      <div id="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content col-md-8">
    <div class="blog-index">
      
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2017-05-16T19:19:19+08:00" pubdate data-updated="true">May 16<span>th</span>, 2017</time>
        
           | <a href="/blog/2017/05/16/go-get-unable-to-connect-to-go-dot-googlesource-dot-com/#disqus_thread"
             data-disqus-identifier="http://baopham.github.io/blog/2017/05/16/go-get-unable-to-connect-to-go-dot-googlesource-dot-com/">Comments</a>
        
      </p>
    
    
      <h1 class="entry-title"><a href="/blog/2017/05/16/go-get-unable-to-connect-to-go-dot-googlesource-dot-com/">Go Get - Unable to Connect to go.googlesource.com</a></h1>
    
  </header>


  <div class="entry-content clearfix"><blockquote><p>Given I want to install a go library<br/>
When I run <code>go get github.com/author/repo</code><br/>
Then I should not see the error <code>unable to connect to go.googlesource.com</code></p></blockquote>

<p>If the above scenario isn&rsquo;t working out for you, make sure you don&rsquo;t have this in your <code>.gitconfig</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[url "git://"]
</span><span class='line'>  insteadOf = https://</span></code></pre></td></tr></table></div></figure>

</div>
  
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2017-04-15T23:18:43+08:00" pubdate data-updated="true">Apr 15<span>th</span>, 2017</time>
        
           | <a href="/blog/2017/04/15/cli-to-manage-your-vim-plugins/#disqus_thread"
             data-disqus-identifier="http://baopham.github.io/blog/2017/04/15/cli-to-manage-your-vim-plugins/">Comments</a>
        
      </p>
    
    
      <h1 class="entry-title"><a href="/blog/2017/04/15/cli-to-manage-your-vim-plugins/">CLI to Manage Your Vim Plugins</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>This is a follow up to my <a href="http://baopham.github.io/blog/2014/05/30/a-command-line-interface-for-vundle/">previous post</a>. I recently switched to <a href="https://github.com/junegunn/vim-plug">vim-plug</a> which I think is nicer to use. You can keep all dependencies together in one line and specify post-install commands, which is not possible with <a href="https://github.com/VundleVim/Vundle.vim">Vundle</a>.</p>

<p>And so, my <a href="https://github.com/baopham/vundle-cli">vundle-cli</a> is now obsolete for my own use. I have to write another CLI and this time it will take care of multiple Vim plugin managers: <a href="https://github.com/baopham/vimplugin-cli">vimplugin-cli</a></p>

<p><img src="/images/vimplugin-cli.gif" alt="VimPlugin CLI gif" class="center"/></p>
</div>
  
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2016-07-23T16:12:41+08:00" pubdate data-updated="true">Jul 23<span>rd</span>, 2016</time>
        
           | <a href="/blog/2016/07/23/schedule-running-full-tests/#disqus_thread"
             data-disqus-identifier="http://baopham.github.io/blog/2016/07/23/schedule-running-full-tests/">Comments</a>
        
      </p>
    
    
      <h1 class="entry-title"><a href="/blog/2016/07/23/schedule-running-full-tests/">Schedule Running Full Tests</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>Often time when your project starts to grow, the test suite also starts to get bigger, i.e slower CI.</p>

<p>You will notice that there are tests that hardly ever fail. Maybe we shouldn&rsquo;t run these every commit? How about run these and the full test suite on schedule such as once a day?</p>

<p>For a Laravel project that is hosted on Github, here is the idea:</p>

<p><strong>1.</strong> Create a branch <code>ci-full-tests</code> off your main branch and set up your CI to run tests for this branch<br/>
<strong>2.</strong> Get a Github OAuth token<br/>
<strong>3.</strong> Create a console command to merge the main branch to <code>ci-full-tests</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nx">App\Console\Commands</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">GuzzleHttp\Client</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Illuminate\Console\Command</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">TriggerCIToRunFullTests</span> <span class="k">extends</span> <span class="nx">Command</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">    * The name and signature of the console command.</span>
</span><span class='line'><span class="sd">    *</span>
</span><span class='line'><span class="sd">    * @var string</span>
</span><span class='line'><span class="sd">    */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$signature</span> <span class="o">=</span> <span class="s1">&#39;ci:full-tests&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">    * The console command description.</span>
</span><span class='line'><span class="sd">    *</span>
</span><span class='line'><span class="sd">    * @var string</span>
</span><span class='line'><span class="sd">    */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$description</span> <span class="o">=</span> <span class="s1">&#39;Trigger CI to run the full tests&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">    * @var Client</span>
</span><span class='line'><span class="sd">    */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$client</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">    * Create a new command instance.</span>
</span><span class='line'><span class="sd">    *</span>
</span><span class='line'><span class="sd">    * @return void</span>
</span><span class='line'><span class="sd">    */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">Client</span> <span class="nv">$client</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">client</span> <span class="o">=</span> <span class="nv">$client</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">    * Execute the console command.</span>
</span><span class='line'><span class="sd">    *</span>
</span><span class='line'><span class="sd">    * @return mixed</span>
</span><span class='line'><span class="sd">    */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">app</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">environment</span><span class="p">()</span> <span class="o">!==</span> <span class="s1">&#39;staging&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">client</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s2">&quot;https://api.github.com/repos/YOUR_ORG/REPO_NAME/merges&quot;</span><span class="p">,</span> <span class="p">[</span>
</span><span class='line'>            <span class="s1">&#39;headers&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span><span class='line'>                <span class="s1">&#39;X-GitHub-Media-Type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/vnd.github.v3+json&#39;</span><span class="p">,</span>
</span><span class='line'>                <span class="s1">&#39;Authorization&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;token &#39;</span> <span class="o">.</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;GITHUB_OAUTH_TOKEN&#39;</span><span class="p">),</span>
</span><span class='line'>            <span class="p">],</span>
</span><span class='line'>            <span class="s1">&#39;json&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
</span><span class='line'>                <span class="s1">&#39;base&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ci-full-tests&#39;</span><span class="p">,</span>
</span><span class='line'>                <span class="s1">&#39;head&#39;</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;BRANCH_FOR_CODESHIP_FULL_TESTS&#39;</span><span class="p">,</span> <span class="s1">&#39;master&#39;</span><span class="p">),</span>
</span><span class='line'>                <span class="s1">&#39;commit_message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;[Schedule] Run full tests&#39;</span><span class="p">,</span>
</span><span class='line'>            <span class="p">],</span>
</span><span class='line'>        <span class="p">]);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>4.</strong> Schedule to run this command once a day</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="c1">// app/Console/Kernel.php</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$schedule</span><span class="o">-&gt;</span><span class="na">command</span><span class="p">(</span><span class="s1">&#39;ci:full-tests&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">daily</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>5.</strong> Add an if condition in your CI bash script</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">ci_branch</span><span class="o">=</span><span class="sb">`</span>printenv GIT_BRANCH<span class="sb">`</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="o">[[</span> <span class="nv">$ci_branch</span> <span class="o">==</span> <span class="s2">&quot;ci-full-tests&quot;</span> <span class="o">]]</span>
</span><span class='line'><span class="k">then</span>
</span><span class='line'><span class="k">    </span>vendor/bin/behat --tags<span class="o">=</span>~@wip
</span><span class='line'><span class="k">else</span>
</span><span class='line'><span class="k">    </span>vendor/bin/behat --tags<span class="o">=</span><span class="s1">&#39;@important&#39;</span>
</span><span class='line'><span class="k">fi</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2016-07-16T10:56:11+08:00" pubdate data-updated="true">Jul 16<span>th</span>, 2016</time>
        
           | <a href="/blog/2016/07/16/204-no-content/#disqus_thread"
             data-disqus-identifier="http://baopham.github.io/blog/2016/07/16/204-no-content/">Comments</a>
        
      </p>
    
    
      <h1 class="entry-title"><a href="/blog/2016/07/16/204-no-content/">204 No Content</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>Response codes such ass 200, 404, 500 are very common response codes. Each code has their own meanings and so of course make sure you use them correctly.</p>

<p>I just discovered a case where our API wasn&rsquo;t returning a JSON and the Mule app started to throw exception when it called the API.</p>

<p>What happens is:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">return</span> <span class="nx">Response</span><span class="o">::</span><span class="na">json</span><span class="p">([</span><span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="p">[],</span> <span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Uh oh&#39;</span><span class="p">],</span> <span class="mi">204</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>is considered as an empty response due to <a href="https://github.com/symfony/symfony/blob/c53cb57b9ddb0e97c3596772d4b4a66c0db14091/src/Symfony/Component/HttpFoundation/Response.php#L267-L270">Symfony\Component\HttpFoundation\Response</a> treating code 204 as empty</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">prepare</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nv">$headers</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">headers</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isInformational</span><span class="p">()</span> <span class="o">||</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isEmpty</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setContent</span><span class="p">(</span><span class="k">null</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$headers</span><span class="o">-&gt;</span><span class="na">remove</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$headers</span><span class="o">-&gt;</span><span class="na">remove</span><span class="p">(</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="c1">//....</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">//....</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//...</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * Is the response empty?</span>
</span><span class='line'><span class="sd"> *</span>
</span><span class='line'><span class="sd"> * @return bool</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">isEmpty</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">in_array</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">statusCode</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="mi">204</span><span class="p">,</span> <span class="mi">304</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2016-07-04T09:30:34+08:00" pubdate data-updated="true">Jul 4<span>th</span>, 2016</time>
        
           | <a href="/blog/2016/07/04/tree-parser/#disqus_thread"
             data-disqus-identifier="http://baopham.github.io/blog/2016/07/04/tree-parser/">Comments</a>
        
      </p>
    
    
      <h1 class="entry-title"><a href="/blog/2016/07/04/tree-parser/">Tree Parser</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>I just wrote a PHP library <a href="https://github.com/baopham/php-tree-parser">baopham/tree-parser</a> to parse a specific tree content to PHP objects.</p>

<p>This library can parse this tree content:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>   Root
</span><span class='line'>    |- Level 1 - Order 1
</span><span class='line'>      |- Level 2 - Order 2
</span><span class='line'>        |- Level 3 - Order 3
</span><span class='line'>        |- Level 3 - Order 4
</span><span class='line'>      |- Level 2 - Order 5
</span><span class='line'>    |- Level 1 - Order 6
</span><span class='line'>      |- Level 2 - Order 7
</span><span class='line'>        |- Level 3 - Order 8
</span><span class='line'>          |- Level 4 - Order 9</span></code></pre></td></tr></table></div></figure>


<p>into this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">foreach</span> <span class="p">(</span><span class="nv">$root</span><span class="o">-&gt;</span><span class="na">children</span> <span class="k">as</span> <span class="nv">$child</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">print</span> <span class="nv">$child</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">print</span> <span class="nv">$child</span><span class="o">-&gt;</span><span class="na">order</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">print</span> <span class="nv">$child</span><span class="o">-&gt;</span><span class="na">level</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nb">print_r</span><span class="p">(</span><span class="nv">$child</span><span class="o">-&gt;</span><span class="na">children</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="nb">print_r</span><span class="p">(</span><span class="nv">$child</span><span class="o">-&gt;</span><span class="na">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">children</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">print</span> <span class="nv">$child</span><span class="o">-&gt;</span><span class="na">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">parent</span> <span class="o">===</span> <span class="nv">$child</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">print</span> <span class="nv">$root</span><span class="o">-&gt;</span><span class="na">isRoot</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// assuming we got the $lastLeaf after done traversing down.</span>
</span><span class='line'><span class="k">print</span> <span class="nv">$lastLeaf</span><span class="o">-&gt;</span><span class="na">parent</span><span class="o">-&gt;</span><span class="na">parent</span><span class="o">-&gt;</span><span class="na">parent</span><span class="o">-&gt;</span><span class="na">parent</span> <span class="o">===</span> <span class="nv">$root</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Advanced</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$tree</span> <span class="o">=</span> <span class="s">&lt;&lt;&lt;TREE</span>
</span><span class='line'><span class="s">  Root</span>
</span><span class='line'><span class="s">    |- Level 1 - Order 1</span>
</span><span class='line'><span class="s">      |- Level 2 - Order 2</span>
</span><span class='line'><span class="s">        |- Level 3 - Order 3</span>
</span><span class='line'><span class="s">        |- Level 3 - Order 4</span>
</span><span class='line'><span class="s">      |- Level 2 - Order 5</span>
</span><span class='line'><span class="s">    |- Level 1 - Order 6</span>
</span><span class='line'><span class="s">      |- Level 2 - Order 7</span>
</span><span class='line'><span class="s">        |- Level 3 - Order 8</span>
</span><span class='line'><span class="s">          |- Level 4 - Order 9</span>
</span><span class='line'><span class="s">TREE;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$parser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BaoPham\TreeParser</span><span class="p">(</span><span class="nv">$tree</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$parser</span><span class="o">-&gt;</span><span class="na">parse</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$structure</span> <span class="o">=</span> <span class="nv">$parser</span><span class="o">-&gt;</span><span class="na">getStructure</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Get nodes at level 3</span>
</span><span class='line'><span class="nv">$level3Nodes</span> <span class="o">=</span> <span class="nv">$structure</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
</span><span class='line'><span class="c1">// Get node at level 3, order 4</span>
</span><span class='line'><span class="nv">$node</span> <span class="o">=</span> <span class="nv">$structure</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">4</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Get last leaf</span>
</span><span class='line'><span class="nv">$orderedNodes</span> <span class="o">=</span> <span class="nv">$parser</span><span class="o">-&gt;</span><span class="na">getOrderedNodes</span><span class="p">();</span>
</span><span class='line'><span class="nv">$lastLeaf</span> <span class="o">=</span> <span class="nv">$orderedNodes</span><span class="p">[</span><span class="nb">count</span><span class="p">(</span><span class="nv">$orderedNodes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2016-05-17T15:52:27+08:00" pubdate data-updated="true">May 17<span>th</span>, 2016</time>
        
           | <a href="/blog/2016/05/17/modelling-with-behat-examples/#disqus_thread"
             data-disqus-identifier="http://baopham.github.io/blog/2016/05/17/modelling-with-behat-examples/">Comments</a>
        
      </p>
    
    
      <h1 class="entry-title"><a href="/blog/2016/05/17/modelling-with-behat-examples/">Modelling With Behat and Laravel Examples</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>Follow up from my previous <a href="http://baopham.github.io/blog/2016/04/03/modelling-with-behat-and-laravel/">post</a>, here is an example feature (similar to the feature from the <a href="http://stakeholderwhisperer.com/posts/2014/10/introducing-modelling-by-example">original post</a>)</p>

<h3>behat.yml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>default:
</span><span class='line'>    suites:
</span><span class='line'>      product_payment_domain:
</span><span class='line'>        contexts: [ ProductPaymentDomainContext ]
</span><span class='line'>        filters:  { tags: '@product_payment' }
</span><span class='line'>      product_payment_ui:
</span><span class='line'>        contexts: [ ProductPaymentUIContext ]
</span><span class='line'>        filters:  { tags: '@product_payment&&@critical' }
</span><span class='line'>    gherkin:
</span><span class='line'>      filters:
</span><span class='line'>        tags: ~@wip
</span><span class='line'>    extensions:
</span><span class='line'>        Laracasts\Behat:
</span><span class='line'>            #env_path: .env.behat
</span><span class='line'>        Behat\MinkExtension:
</span><span class='line'>            base_url: https://e-commerce.dev
</span><span class='line'>            default_session: laravel
</span><span class='line'>            laravel: ~
</span><span class='line'>            selenium2:
</span><span class='line'>              wd_host: "http://selenium-server.dev:4444/wd/hub"
</span><span class='line'>            browser_name: chrome</span></code></pre></td></tr></table></div></figure>


<h3>Feature and Scenarios</h3>

<blockquote><p>How To Write Scenarios</p>

<p>Focus on describing the problem you&rsquo;re trying to solve, rather than focusing on the &ldquo;how&rdquo; and the &ldquo;look&rdquo;. For example, don&rsquo;t mention anything about &ldquo;I click button x&rdquo; or &ldquo;I go page /path/to/page&rdquo; or &ldquo;I should see ABC on sidebar&rdquo; or &ldquo;I wait&rdquo; in your scenarios.</p>

<p>Read more here: <a href="http://stakeholderwhisperer.com/posts/2014/10/introducing-modelling-by-example">Introducing Modelling by Example</a></p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Feature: Product payment
</span><span class='line'>  In order to receive products
</span><span class='line'>  As a customer
</span><span class='line'>  I need to be able to pay for the products that I have selected
</span><span class='line'>
</span><span class='line'>  Scenario: Buying a product that is out of stock
</span><span class='line'>    Given I have put the product "Windows ME" in my basket a few days before
</span><span class='line'>    And product "Window ME" is now out of stock
</span><span class='line'>    Then I should not be able to checkout because "Window ME" is out of stock
</span><span class='line'>
</span><span class='line'>  Scenario: Cannot buy if product is restricted in the account's country
</span><span class='line'>    Given I am located in a country that does not allow product "FooBar"
</span><span class='line'>    Then I cannot purchase this product</span></code></pre></td></tr></table></div></figure>


<p>How I would implement the steps in the Domain Context class:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @Given I have put the product :product in my basket a few days before</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">iHavePutTheProductInMyBasket</span><span class="p">(</span><span class="nv">$product</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">product</span> <span class="o">=</span> <span class="nx">factory</span><span class="p">(</span><span class="nx">Product</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="nv">$product</span><span class="p">]);</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">basket</span><span class="o">-&gt;</span><span class="na">put</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">product</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @Given product :product is now out of stock</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">ProductIsOutOfStock</span><span class="p">(</span><span class="nv">$product</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">product</span><span class="o">-&gt;</span><span class="na">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">product</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @Then I should not be able to checkout because :product is out of stock</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">iShouldNotBeAbleToCheckoutBecauseProductIsOutOfStock</span><span class="p">(</span><span class="nv">$product</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertException</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">basket</span><span class="o">-&gt;</span><span class="na">checkout</span><span class="p">();</span>
</span><span class='line'>    <span class="p">},</span> <span class="nx">ProductIsOutOfStock</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @Given I am located in a country that does not allow product :product</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">iAmLocatedInACountryThatDoesNotAllowProduct</span><span class="p">(</span><span class="nv">$product</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentUser</span> <span class="o">=</span> <span class="nx">factory</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">product</span> <span class="o">=</span> <span class="nx">factory</span><span class="p">(</span><span class="nx">Product</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="nv">$product</span><span class="p">]);</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentUser</span><span class="o">-&gt;</span><span class="na">country</span><span class="o">-&gt;</span><span class="na">restricted_products</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">sync</span><span class="p">([</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">product</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">]);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @Then I cannot purchase this product</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">iCannotPurchaseThisProduct</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentUser</span><span class="o">-&gt;</span><span class="na">cannot</span><span class="p">(</span><span class="s1">&#39;purchase&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">product</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>where the method <code>assertException</code> is a custom method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @param Closure $closure</span>
</span><span class='line'><span class="sd"> * @param string $exception</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">protected</span> <span class="k">function</span> <span class="nf">assertException</span><span class="p">(</span><span class="nx">\Closure</span> <span class="nv">$closure</span><span class="p">,</span> <span class="nv">$exception</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nv">$fail</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">try</span> <span class="p">{</span>
</span><span class='line'>        <span class="nv">$closure</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="nv">$fail</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nv">$e</span> <span class="nx">instanceof</span> <span class="nv">$exception</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>            <span class="nv">$fail</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nv">$fail</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fail</span><span class="p">(</span><span class="s2">&quot;Expected </span><span class="si">$exception</span><span class="s2"> to be thrown&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>and if you follow my <a href="http://baopham.github.io/blog/2016/04/04/modelling-with-behat-and-laravel/">previous post</a>, the <code>assertEquals</code> is forwarded to the <code>PHPUnit_Framework_Assert</code> class.</p>
</div>
  
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2016-04-04T14:17:34+08:00" pubdate data-updated="true">Apr 4<span>th</span>, 2016</time>
        
           | <a href="/blog/2016/04/04/modelling-with-behat-and-laravel/#disqus_thread"
             data-disqus-identifier="http://baopham.github.io/blog/2016/04/04/modelling-with-behat-and-laravel/">Comments</a>
        
      </p>
    
    
      <h1 class="entry-title"><a href="/blog/2016/04/04/modelling-with-behat-and-laravel/">Modelling With Behat and Laravel</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>Here is an interesting read talking about how to &ldquo;do a Domain-Driven Design while doing Behaviour-Driven Development&rsquo;s red-green-refactor cycle&rdquo;: <a href="http://stakeholderwhisperer.com/posts/2014/10/introducing-modelling-by-example">Introducing Modelling by Example</a></p>

<p>If you like the author&rsquo;s idea and want to apply this to your Laravel projects, here is something you can do to get most (if not all) Laravel PHPUnit helper methods in your Behat Domain Context class:</p>

<ul>
<li>Install <a href="https://github.com/laracasts/Behat-Laravel-Extension">Behat-Laravel-Extension</a></li>
<li>Have a base Context class. I call it <code>DomainContext</code> but you could do something similar for the default <code>FeatureContext</code>. Having a separate abstract parent class lets me divide my context classes into 2 categories: UI and Domain.</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="nx">App\User</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Behat\Behat\Context\SnippetAcceptingContext</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Behat\MinkExtension\Context\MinkContext</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\ApplicationTrait</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\CrawlerTrait</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Auth</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Session</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Laracasts\Behat\Context\KernelAwareContext</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">PHPUnit_Framework_Assert</span> <span class="k">as</span> <span class="nx">PHPUnit</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Symfony\Component\HttpKernel\HttpKernelInterface</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">abstract</span> <span class="k">class</span> <span class="nc">DomainContext</span> <span class="k">extends</span> <span class="nx">MinkContext</span> <span class="k">implements</span> <span class="nx">KernelAwareContext</span><span class="p">,</span> <span class="nx">SnippetAcceptingContext</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">use</span> <span class="nx">ApplicationTrait</span><span class="p">;</span>
</span><span class='line'>    <span class="k">use</span> <span class="nx">CrawlerTrait</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$baseUrl</span> <span class="o">=</span> <span class="s1">&#39;http://localhost&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * @var User</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$currentUser</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">setApp</span><span class="p">(</span><span class="nx">HttpKernelInterface</span> <span class="nv">$app</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span> <span class="o">=</span> <span class="nv">$app</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">be</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nx">Session</span><span class="o">::</span><span class="na">start</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">Auth</span><span class="o">::</span><span class="na">loginUsingId</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">currentUser</span> <span class="o">=</span> <span class="nv">$user</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__call</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$arguments</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nb">forward_static_call_array</span><span class="p">([</span><span class="nx">PHPUnit</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$name</span><span class="p">],</span> <span class="nv">$arguments</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Extend this base class for all your Domain Context classes then you will have access to methods such as:</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">be</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;_token&#39;</span> <span class="o">=&gt;</span>  <span class="nx">csrf_token</span><span class="p">(),</span> <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo@bar.com&#39;</span><span class="p">]);</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectsJobs</span><span class="p">(</span><span class="nx">SendInvitationEmail</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">seeInDatabase</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo@bar.com&#39;</span><span class="p">]);</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2016-04-04T13:57:47+08:00" pubdate data-updated="true">Apr 4<span>th</span>, 2016</time>
        
           | <a href="/blog/2016/04/04/behat-selenium-and-virtualbox/#disqus_thread"
             data-disqus-identifier="http://baopham.github.io/blog/2016/04/04/behat-selenium-and-virtualbox/">Comments</a>
        
      </p>
    
    
      <h1 class="entry-title"><a href="/blog/2016/04/04/behat-selenium-and-virtualbox/">Behat, Selenium and VirtualBox</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>If you want to run selenium server on the host machine and behat in VirtualBox, this setup could work for you:</p>

<figure class='code'><figcaption><span>behat.yml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">default</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">extensions</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">Behat\MinkExtension</span><span class="p-Indicator">:</span>
</span><span class='line'>            <span class="l-Scalar-Plain">base_url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">https://foobar.dev</span>
</span><span class='line'>            <span class="l-Scalar-Plain">selenium2</span><span class="p-Indicator">:</span>
</span><span class='line'>                <span class="l-Scalar-Plain">wd_host</span><span class="p-Indicator">:</span> <span class="s">&quot;http://selenium-server.dev:4444/wd/hub&quot;</span>
</span><span class='line'>            <span class="l-Scalar-Plain">browser_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">chrome</span>
</span></code></pre></td></tr></table></div></figure>


<p>In your virtualbox, edit the <code>/etc/hosts</code> and add a line:</p>

<figure class='code'><figcaption><span>/etc/hosts</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>10.0.2.2 selenium-server.dev
</span></code></pre></td></tr></table></div></figure>


<p>Then run your selenium server on your host machine.</p>
</div>
  
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2016-02-12T23:46:33+08:00" pubdate data-updated="true">Feb 12<span>th</span>, 2016</time>
        
           | <a href="/blog/2016/02/12/aws-cloudformation-reusable-variables/#disqus_thread"
             data-disqus-identifier="http://baopham.github.io/blog/2016/02/12/aws-cloudformation-reusable-variables/">Comments</a>
        
      </p>
    
    
      <h1 class="entry-title"><a href="/blog/2016/02/12/aws-cloudformation-reusable-variables/">AWS CloudFormation Reusable Variables</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>Here is a way to create reusable strings / numbers / etc. in CloudFormation.</p>

<p>1 &ndash; Create Lambda resource to build the values you need.</p>

<p>2 &ndash; Create a custom resource to store the value returned from the Lambda</p>

<p>Example: Here we have a custom resource <code>AppInfo</code> to hold the App information.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="s2">&quot;Resources&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;AppInfo&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;Type&quot;</span><span class="o">:</span> <span class="s2">&quot;Custom::AppInfo&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;Properties&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;ServiceToken&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;Fn::GetAtt&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;GetAppInfo&quot;</span><span class="p">,</span> <span class="s2">&quot;Arn&quot;</span><span class="p">]</span> <span class="p">},</span>
</span><span class='line'>      <span class="s2">&quot;BuildVersion&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;Ref&quot;</span><span class="o">:</span> <span class="s2">&quot;BuildVersion&quot;</span> <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="s2">&quot;GetAppInfo&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;Type&quot;</span><span class="o">:</span> <span class="s2">&quot;AWS::Lambda::Function&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;Properties&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;Handler&quot;</span><span class="o">:</span> <span class="s2">&quot;index.handler&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;Role&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;Fn::GetAtt&quot;</span> <span class="o">:</span> <span class="p">[</span><span class="s2">&quot;LambdaExecutionRole&quot;</span><span class="p">,</span> <span class="s2">&quot;Arn&quot;</span><span class="p">]</span> <span class="p">},</span>
</span><span class='line'>      <span class="s2">&quot;Code&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;ZipFile&quot;</span><span class="o">:</span>  <span class="p">{</span> <span class="s2">&quot;Fn::Join&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">[</span>
</span><span class='line'>          <span class="s2">&quot;var response = require(&#39;cfn-response&#39;);&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;exports.handler = function(event, context) {&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;   var username = &#39;&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="p">{</span>
</span><span class='line'>              <span class="s2">&quot;Fn::Join&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="p">[</span> <span class="p">{</span><span class="s2">&quot;Ref&quot;</span><span class="o">:</span> <span class="s2">&quot;AppName&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;Ref&quot;</span><span class="o">:</span> <span class="s2">&quot;AppEnv&quot;</span><span class="p">}</span> <span class="p">]</span> <span class="p">]</span>
</span><span class='line'>          <span class="p">},</span>
</span><span class='line'>          <span class="s2">&quot;&#39;;&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;   var email = &#39;&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="p">{</span>
</span><span class='line'>              <span class="s2">&quot;Fn::Join&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">[</span> <span class="p">{</span><span class="s2">&quot;Ref&quot;</span><span class="o">:</span> <span class="s2">&quot;AppName&quot;</span><span class="p">},</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Ref&quot;</span><span class="o">:</span> <span class="s2">&quot;AppEnv&quot;</span><span class="p">},</span> <span class="s2">&quot;@gmail.com&quot;</span> <span class="p">]</span> <span class="p">]</span>
</span><span class='line'>          <span class="p">},</span>
</span><span class='line'>          <span class="s2">&quot;&#39;;&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;   var responseData = { Username: username, Email: email };&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;   response.send(event, context, response.SUCCESS, responseData);&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;};&quot;</span>
</span><span class='line'>          <span class="p">]]</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">},</span>
</span><span class='line'>      <span class="s2">&quot;Runtime&quot;</span><span class="o">:</span> <span class="s2">&quot;nodejs&quot;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="s2">&quot;LambdaExecutionRole&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;Type&quot;</span><span class="o">:</span> <span class="s2">&quot;AWS::IAM::Role&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;Properties&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="s2">&quot;AssumeRolePolicyDocument&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;Version&quot;</span><span class="o">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;Statement&quot;</span><span class="o">:</span> <span class="p">[{</span> <span class="s2">&quot;Effect&quot;</span><span class="o">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span> <span class="s2">&quot;Principal&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;Service&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;lambda.amazonaws.com&quot;</span><span class="p">]},</span> <span class="s2">&quot;Action&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;sts:AssumeRole&quot;</span><span class="p">]</span> <span class="p">}]</span>
</span><span class='line'>      <span class="p">},</span>
</span><span class='line'>      <span class="s2">&quot;Path&quot;</span><span class="o">:</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;Policies&quot;</span><span class="o">:</span> <span class="p">[{</span>
</span><span class='line'>        <span class="s2">&quot;PolicyName&quot;</span><span class="o">:</span> <span class="s2">&quot;root&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;PolicyDocument&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>          <span class="s2">&quot;Version&quot;</span><span class="o">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;Statement&quot;</span><span class="o">:</span> <span class="p">[{</span> <span class="s2">&quot;Effect&quot;</span><span class="o">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span> <span class="s2">&quot;Action&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;logs:*&quot;</span><span class="p">],</span> <span class="s2">&quot;Resource&quot;</span><span class="o">:</span> <span class="s2">&quot;arn:aws:logs:*:*:*&quot;</span> <span class="p">}]</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>3 &ndash; Reference the custom resource with <code>Fn::GetAtt</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">{</span> <span class="s2">&quot;Fn::GetAtt&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;AppInfo&quot;</span><span class="p">,</span> <span class="s2">&quot;Username&quot;</span> <span class="p">]</span> <span class="p">},</span>
</span><span class='line'><span class="p">{</span> <span class="s2">&quot;Fn::GetAtt&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;AppInfo&quot;</span><span class="p">,</span> <span class="s2">&quot;Email&quot;</span> <span class="p">]</span> <span class="p">}</span>
</span><span class='line'><span class="p">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>4 &ndash; Create a parameter <code>BuildVersion</code>. This is the key to make sure the custom resource <code>AppInfo</code> is updated when you update your parameters <code>AppName</code> or <code>AppEnv</code>. Without it, when you update these 2 parameters, CloudFormation will only update Lambda function and leave the resource <code>AppInfo</code> the same without sending another request to <code>GetAppInfo</code> for the latest value.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="s2">&quot;Parameters&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;BuildVersion&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;Description&quot;</span><span class="o">:</span> <span class="s2">&quot;Build Version. Needs to be different everytime you make an update&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;Type&quot;</span><span class="o">:</span> <span class="s2">&quot;String&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;MinLength&quot;</span><span class="o">:</span> <span class="mi">1</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2015-09-22T15:21:39+08:00" pubdate data-updated="true">Sep 22<span>nd</span>, 2015</time>
        
           | <a href="/blog/2015/09/22/a-dynamodb-wrapper-for-laravel-model/#disqus_thread"
             data-disqus-identifier="http://baopham.github.io/blog/2015/09/22/a-dynamodb-wrapper-for-laravel-model/">Comments</a>
        
      </p>
    
    
      <h1 class="entry-title"><a href="/blog/2015/09/22/a-dynamodb-wrapper-for-laravel-model/">A DynamoDb Wrapper for Laravel Model</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>With this package <a href="https://packagist.org/packages/baopham/dynamodb">baopham/dynamodb</a>, you can do:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">class</span> <span class="nc">Campaign</span> <span class="k">extends</span> <span class="nx">BaoPham\DynamoDb\DynamoDbModel</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$table</span> <span class="o">=</span> <span class="s1">&#39;dynamodb_table_for_campaign&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$fillable</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$campaign</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Campaign</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$campaign</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;campaign-id&#39;</span><span class="p">);</span> <span class="c1">// it&#39;s best to use UUID instead of incremented id - less work since you have to set the id attribute yourself.</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// or</span>
</span><span class='line'><span class="nv">$campaign</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span>
</span><span class='line'>        <span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// or</span>
</span><span class='line'><span class="nv">$campaign</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// or</span>
</span><span class='line'><span class="nv">$campaign</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo2&#39;</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bar2&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">]);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// or</span>
</span><span class='line'><span class="nv">$campaign</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;campaign-id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>For more, <code>README</code>, tests and code are available here: <a href="https://github.com/baopham/laravel-dynamodb">https://github.com/baopham/laravel-dynamodb</a></p>
</div>
  
  


        </article>
      
    </div>

    <ul class="pager">
      
        <li class="previous"><a href="/blog/page/2/">&larr;&nbsp;Older</a></li>
      
      <li><a href="/blog/archives">Blog Archives</a></li>
      
        <li class="next disabled"><a href="#">Newer&nbsp;&rarr;</a></li>
      
    </ul>
  </div>

  
    <div class="col-md-1"></div>
    <aside class="sidebar col-md-3 visible-md visible-lg text-center">
      
        
  <section>
    <div>
      <img class="img-circle gravatar-img" src="http://www.gravatar.com/avatar/d1747ec1e8e0325b54071a4f1dab5744?s=400" alt="Gravatar of Bao Pham " title="Gravatar of Bao Pham" />
    </div>
  </section>

  <section>
    <ul class="media-list list-inline">
      
        <li class="media">
          <a href="http://github.com/baopham">
            <img class="media-object" src="/images/GitHub-Mark-32px.png" alt="My Github"/>
          </a>
        </li>
      
      
        <li class="media">
          <a href="mailto:gbaopham@gmail.com">
            <img class="media-object" src="/images/email.png" alt="Email me"/>
          </a>
        </li>
      
    </ul>
  </section>

<section>
  <h3>About Me</h3>
  <p>Hello. You can call me Bao.</p>
  <p>
    I graduated from the <a href="http://ubc.ca">University of British Columbia</a>
    with a combined major in Math and Computer Science. I do (almost) everything in
    <a href="http://github.com/baopham/vim">Vim</a> and like to spend many hours learning new technologies and tools.
  </p>
</section>
<section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Recent Posts</h3>
  </div>
  
  <div id="recent_posts" class="list-group">
    
    <a class="list-group-item " href="/blog/2017/05/16/go-get-unable-to-connect-to-go-dot-googlesource-dot-com/">Go Get - Unable to Connect to go.googlesource.com</a>
    
    <a class="list-group-item " href="/blog/2017/04/15/cli-to-manage-your-vim-plugins/">CLI to Manage Your Vim Plugins</a>
    
    <a class="list-group-item " href="/blog/2016/07/23/schedule-running-full-tests/">Schedule Running Full Tests</a>
    
    <a class="list-group-item " href="/blog/2016/07/16/204-no-content/">204 No Content</a>
    
    <a class="list-group-item " href="/blog/2016/07/04/tree-parser/">Tree Parser</a>
    
  </div>
</section>
<section class="panel panel-default">
  <div class="panel-heading"> 
    <h3 class="panel-title">Tag Cloud</h3>
  </div>
  <div class="panel-body">
    <span id="tag-cloud"><a class='text-primary' href='/blog/categories/angularjs' style='font-size: 108.57142857142857%;'>Angularjs</a> <a class='text-primary' href='/blog/categories/aws' style='font-size: 108.57142857142857%;'>AWS</a> <a class='text-danger' href='/blog/categories/behat' style='font-size: 125.71428571428572%;'>Behat</a> <a class='text-primary' href='/blog/categories/ci' style='font-size: 108.57142857142857%;'>CI</a> <a class='text-primary' href='/blog/categories/cli' style='font-size: 108.57142857142857%;'>CLI</a> <a class='text-primary' href='/blog/categories/cloudformation' style='font-size: 108.57142857142857%;'>CloudFormation</a> <a class='text-primary' href='/blog/categories/dynamodb' style='font-size: 108.57142857142857%;'>DynamoDb</a> <a class='text-primary' href='/blog/categories/flowjs' style='font-size: 108.57142857142857%;'>Flowjs</a> <a class='text-success' href='/blog/categories/github' style='font-size: 117.14285714285714%;'>Github</a> <a class='text-primary' href='/blog/categories/go' style='font-size: 108.57142857142857%;'>Go</a> <a class='text-success' href='/blog/categories/html5' style='font-size: 117.14285714285714%;'>HTML5</a> <a class='text-danger' href='/blog/categories/javascript' style='font-size: 142.85714285714286%;'>JavaScript</a> <a class='text-primary' href='/blog/categories/knockout-js' style='font-size: 108.57142857142857%;'>Knockout.js</a> <a class='text-danger' href='/blog/categories/laravel' style='font-size: 160.0%;'>Laravel</a> <a class='text-primary' href='/blog/categories/laravel-' style='font-size: 108.57142857142857%;'>Laravel,</a> <a class='text-success' href='/blog/categories/math' style='font-size: 117.14285714285714%;'>Math</a> <a class='text-primary' href='/blog/categories/node-js' style='font-size: 108.57142857142857%;'>Node.js</a> <a class='text-danger' href='/blog/categories/php' style='font-size: 151.42857142857144%;'>PHP</a> <a class='text-primary' href='/blog/categories/php-' style='font-size: 108.57142857142857%;'>PHP,</a> <a class='text-primary' href='/blog/categories/python' style='font-size: 108.57142857142857%;'>Python</a> <a class='text-success' href='/blog/categories/ruby' style='font-size: 117.14285714285714%;'>Ruby</a> <a class='text-danger' href='/blog/categories/s3' style='font-size: 125.71428571428572%;'>S3</a> <a class='text-primary' href='/blog/categories/selenium' style='font-size: 108.57142857142857%;'>Selenium</a> <a class='text-primary' href='/blog/categories/semantic-ui' style='font-size: 108.57142857142857%;'>Semantic-UI</a> <a class='text-primary' href='/blog/categories/symfony' style='font-size: 108.57142857142857%;'>Symfony</a> <a class='text-primary' href='/blog/categories/testing' style='font-size: 108.57142857142857%;'>Testing</a> <a class='text-success' href='/blog/categories/vim' style='font-size: 117.14285714285714%;'>Vim</a> <a class='text-primary' href='/blog/categories/virtualbox' style='font-size: 108.57142857142857%;'>VirtualBox</a> <a class='text-success' href='/blog/categories/web-development' style='font-size: 117.14285714285714%;'>Web Development</a> </span>
  </div>
</section>

<section class="panel panel-default clearfix">
  <div class="panel-heading">
    <h3 class="panel-title">GitHub Repos</h3>
  </div>
  <div class="list-group" id="gh_repos">
    <p class="loading">Status updating&#8230;</p>
  </div>
  
    <div class="gh-profile-link pull-right text-muted">
      <a href="https://github.com/baopham">@baopham</a> on GitHub
    </div>
  
  <script type="text/javascript">
    $(document).ready(function(){
      if (!window.jXHR){
	var jxhr = document.createElement('script');
	jxhr.type = 'text/javascript';
	jxhr.src = '/javascripts/libs/jXHR.js';
	var s = document.getElementsByTagName('script')[0];
	s.parentNode.insertBefore(jxhr, s);
      }

      github.showRepos({
	user: 'baopham',
	count: 10,
	skip_forks: true,
	target: '#gh_repos'
      });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


      
    </aside>
  
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
  <p class="text-muted credits">
  Copyright &copy; 2017 - Bao Pham - <a href="/privacy">Privacy Policy</a><br>
  <small>
    <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
    <span class="credit">customized with <a href="https://github.com/kAworu/octostrap3">octostrap3</a></span>.
  </small>
</p>

</div>
</footer>
    <script src="/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr-2.0.js"></script>


<script type="text/javascript">
  var disqus_shortname = 'baopham-github-io';
  
    
    var disqus_script = 'count.js';
  
  (function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + disqus_shortname + '.disqus.com/' + disqus_script;
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  }());
</script>









<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet">
<script src="/javascripts/custom/theme.js"></script>


  </body>
</html>
